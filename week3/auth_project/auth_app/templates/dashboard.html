 {% extends 'layouts/app.html' %}
{% comment %}
{% block content %}

<h1>Dashboard : {{ request.user.username }}</h1>
<a href="{% url 'logout' %}" class="btn btn-dark">Logout</a>


{% endblock %} 

{% extends 'layouts/app.html' %}
{% endcomment %}

{% comment %} {% block content %}
<h1>Dashboard : {{ request.user.username }}</h1>
<a href="{% url 'logout' %}" class="btn btn-dark">Logout</a>

<!-- Post message form -->
<form id="post-form" method="post" enctype="multipart/form-data">
    {% csrf_token %}
    <div class="form-group">
        <label for="message">Message:</label>
        <textarea id="message" name="message" class="form-control" rows="3"></textarea>
    </div>
    <div class="form-group">
        <label for="media">Media:</label>
        <input type="file" id="media" name="media" class="form-control-file">
    </div>
    <button type="submit" class="btn btn-primary">Post</button>
</form>

<!-- Display messages -->
<h2>Posts</h2>
<div id="posts">
    <!-- Messages will be loaded here via JavaScript -->
</div>

<!-- Edit message modal -->
<div class="modal" id="editModal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Edit Post</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form id="edit-form" method="post" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="form-group">
                <label for="edit-message">Message:</label>
                <textarea id="edit-message" name="message" class="form-control" rows="3"></textarea>
            </div>
            <div class="form-group">
                <label for="edit-media">Media:</label>
                <input type="file" id="edit-media" name="media" class="form-control-file">
            </div>
            <input type="hidden" id="edit-post-id" name="post_id">
            <button type="submit" class="btn btn-primary">Save changes</button>
        </form>
      </div>
    </div>
  </div>
</div>

{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Function to load posts
        function loadPosts() {
            fetch('/api/posts/')
                .then(response => response.json())
                .then(data => {
                    const postsDiv = document.getElementById('posts');
                    postsDiv.innerHTML = '';
                    data.posts.forEach(post => {
                        postsDiv.innerHTML += `
                            <div class="post" data-id="${post.id}">
                                <p>${post.message}</p>
                                ${post.media ? `<img src="${post.media}" alt="Post media" class="img-fluid">` : ''}
                                <button class="btn btn-secondary edit-post">Edit</button>
                                <button class="btn btn-danger delete-post">Delete</button>
                            </div>
                        `;
                    });
                });
        }

        // Load posts on page load
        loadPosts();

        // Handle post form submission
        document.getElementById('post-form').addEventListener('submit', function (e) {
            e.preventDefault();
            const formData = new FormData(this);
            fetch('/api/posts/', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    loadPosts();
                    this.reset();
                } else {
                    alert('Error posting message.');
                }
            });
        });

        // Handle edit button click
        document.getElementById('posts').addEventListener('click', function (e) {
            if (e.target.classList.contains('edit-post')) {
                const postDiv = e.target.closest('.post');
                const postId = postDiv.getAttribute('data-id');
                const message = postDiv.querySelector('p').textContent;

                document.getElementById('edit-message').value = message;
                document.getElementById('edit-post-id').value = postId;
                $('#editModal').modal('show');
            }
        });

        // Handle edit form submission
        document.getElementById('edit-form').addEventListener('submit', function (e) {
            e.preventDefault();
            const postId = document.getElementById('edit-post-id').value;
            const formData = new FormData(this);
            fetch(`/api/posts/${postId}/`, {
                method: 'PUT',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    loadPosts();
                    $('#editModal').modal('hide');
                } else {
                    alert('Error editing message.');
                }
            });
        });

        // Handle delete button click
        document.getElementById('posts').addEventListener('click', function (e) {
            if (e.target.classList.contains('delete-post')) {
                const postDiv = e.target.closest('.post');
                const postId = postDiv.getAttribute('data-id');
                if (confirm('Are you sure you want to delete this post?')) {
                    fetch(`/api/posts/${postId}/`, {
                        method: 'DELETE'
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            loadPosts();
                        } else {
                            alert('Error deleting message.');
                        }
                    });
                }
            }
        });
    });
</script>
{% endblock %} {% endcomment %}



{% block content %}
<h1>Dashboard : {{ request.user.username }}</h1>
<a href="{% url 'logout' %}" class="btn btn-dark">Logout</a>

<!-- Post message form -->
<form id="post-form" method="post" enctype="multipart/form-data">
    {% csrf_token %}
    <div class="form-group">
        <label for="message">Message:</label>
        <textarea id="message" name="message" class="form-control" rows="3"></textarea>
    </div>
    <div class="form-group">
        <label for="media">Media:</label>
        <input type="file" id="media" name="media" class="form-control-file">
    </div>
    <button type="submit" class="btn btn-primary">Post</button>
</form>

<!-- Display messages -->
<h2>Posts</h2>
<div id="posts">
    {% for post in posts %}
        <div class="post" data-id="{{ post.id }}">
            <p>{{ post.message }}</p>
            {% if post.media %}
                <img src="{{ post.media.url }}" alt="Post media" class="img-fluid">
            {% endif %}
            <button class="btn btn-secondary edit-post">Edit</button>
            <button class="btn btn-danger delete-post">Delete</button>
        </div>
    {% endfor %}
</div>

<!-- Edit message modal -->
<div class="modal" id="editModal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Edit Post</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form id="edit-form" method="post" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="form-group">
                <label for="edit-message">Message:</label>
                <textarea id="edit-message" name="message" class="form-control" rows="3"></textarea>
            </div>
            <div class="form-group">
                <label for="edit-media">Media:</label>
                <input type="file" id="edit-media" name="media" class="form-control-file">
            </div>
            <input type="hidden" id="edit-post-id" name="post_id">
            <button type="submit" class="btn btn-primary">Save changes</button>
        </form>
      </div>
    </div>
  </div>
</div>

{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Function to load posts
        function loadPosts() {
            fetch('/api/posts/')
                .then(response => response.json())
                .then(data => {
                    const postsDiv = document.getElementById('posts');
                    postsDiv.innerHTML = '';
                    data.posts.forEach(post => {
                        postsDiv.innerHTML += `
                            <div class="post" data-id="${post.id}">
                                <p>${post.message}</p>
                                ${post.media ? `<img src="${post.media}" alt="Post media" class="img-fluid">` : ''}
                                <button class="btn btn-secondary edit-post">Edit</button>
                                <button class="btn btn-danger delete-post">Delete</button>
                            </div>
                        `;
                    });
                });
        }

        // Load posts on page load
        loadPosts();

        // Handle post form submission
        document.getElementById('post-form').addEventListener('submit', function (e) {
            e.preventDefault();
            const formData = new FormData(this);
            fetch('/api/posts/', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    loadPosts();
                    this.reset();
                } else {
                    alert('Error posting message.');
                }
            });
        });

        // Handle edit button click
        document.getElementById('posts').addEventListener('click', function (e) {
            if (e.target.classList.contains('edit-post')) {
                const postDiv = e.target.closest('.post');
                const postId = postDiv.getAttribute('data-id');
                const message = postDiv.querySelector('p').textContent;

                document.getElementById('edit-message').value = message;
                document.getElementById('edit-post-id').value = postId;
                $('#editModal').modal('show');
            }
        });

        // Handle edit form submission
        document.getElementById('edit-form').addEventListener('submit', function (e) {
            e.preventDefault();
            const postId = document.getElementById('edit-post-id').value;
            const formData = new FormData(this);
            fetch(`/api/posts/${postId}/`, {
                method: 'PUT',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    loadPosts();
                    $('#editModal').modal('hide');
                } else {
                    alert('Error editing message.');
                }
            });
        });

        // Handle delete button click
        document.getElementById('posts').addEventListener('click', function (e) {
            if (e.target.classList.contains('delete-post')) {
                const postDiv = e.target.closest('.post');
                const postId = postDiv.getAttribute('data-id');
                if (confirm('Are you sure you want to delete this post?')) {
                    fetch(`/api/posts/${postId}/`, {
                        method: 'DELETE'
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            loadPosts();
                        } else {
                            alert('Error deleting message.');
                        }
                    });
                }
            }
        });
    });
</script>
{% endblock %}
